---
tags: ["GraphQl", "Security", "DDoS"]
title: "Mitigating Resource-Exhaustion Attacks (DDoS) on GraphQL APIs: Best Practices and Strategies"
isFeatured: true
isPublished: true
modifiedAt: ""
publishedAt: "2023-04-04T05:35:07.322Z"
previewText: "One of the most common and devastating attacks that GraphQL APIs can face is the resource-exhaustion attacks, also known as Distributed Denial of Service (DDoS). This type of attack floods the API server with malicious requests, overwhelming its resources and making it unavailable to legitimate users"
coverImage:
  alt: "Mitigating Resource-Exhaustion Attacks (DDoS) on GraphQL APIs: Best Practices and Strategies"
  src: "/assets/images/articles/Mitigating-Resource-Exhaustion-Attacks-(DDoS)-on-GraphQL-APIs-Best-Practices-and-Strategies.png"
  type: "image/png"
  width: 1366
  height: 662
author:
  name: Musa Knowledge
  avatar:
    alt: "Musa Knowledge"
    src: "/assets/images/musa-knowledge.jpeg"
    type: "image/jpeg"
    width: 1757
    height: 2334
  socials:
    website: ""
    twitter: ""
    linkedin: ""
ogImage:
  alt: "Mitigating Resource-Exhaustion Attacks (DDoS) on GraphQL APIs: Best Practices and Strategies"
  src: "/assets/images/articles/Mitigating-Resource-Exhaustion-Attacks-(DDoS)-on-GraphQL-APIs-Best-Practices-and-Strategies.png"
  type: "image/png"
  width: 1366
  height: 662
---

One of the most common and devastating attacks or security threats that GraphQL APIs face is resource-exhaustion attacks, also known as Distributed Denial of Service (DDoS). This type of attack floods your GraphQl API server with malicious queries, overwhelming its resources, making it unresponsive and unable the complete the usual request-response lifecycle to genuine users.

In this article, we'll focus on some best practices and strategies to mitigate resource-exhaustion attacks specifically on GraphQl APIs. But before we dive into the solutions, let's first take a closer look at what resource-exhaustion attacks are and how they work.

## What are Resource-Exhaustion Attacks and How do They Impact GraphQL API Server's Performance?

Resource-exhaustion attacks, aka DDoS attacks, are a type of cyber attack in which an attacker floods a server with a high volume of requests in a short period of time. The purpose of such an attack is to exhaust the server's resources and make it unavailable to legitimate users.

In the context of a GraphQL APIs, a resource-exhaustion attack can take many forms. For example, an attacker may send a large number of queries with circular dependencies that are computationally expensive, consuming a significant amount of the server's processing power.

The effect of resource-exhaustion attacks on GraphQL API servers are not limited to technical issues like degraded performance or complete downtimes. Successful attacks can also lead to significant financial and reputational damage.

Now, let's take a look at some code examples to better understand how a this attacks can affect a GraphQL API server, In these examples, we'll use Apollo Server, a popular implementation of GraphQL, and simulate an attack using a tool called [Artillery](https://www.artillery.io/) for sending graphql queries.

### Query with Circular Dependencies

The first example simulates an attack in which an attacker sends a large number of queries with circular dependencies. Circular dependencies occur when a query requires data that is itself dependent on the query. For example, consider the following schema:

> You can find the complete source code for all the examples in this [github repository](https://github.com/huboh/graphql-resource-exhaustion-attack)

```graphql:schema.graphql showLineNumbers
type User {
  id: ID!
  name: String
  email: String!
  posts: [Post!]!
  ...
}

type Post {
  id: ID!
  title: String!
  author: User!
  content: String!
  isPublished: Boolean!
  ...
}

# The "Query" type is special: it lists all of the available queries
# that clients can execute, along with the return type for each.
type Query {
  me: User
  user(userId: ID): User
  post(userId: ID): Post
}
```

In our schema above, a blog post has an author, and an author(user) has many books. If an attacker sends a query for a user, which in turn requires his/her posts, which requires the author, which in turn require his/her posts again, the server will be stuck in an infinite loop, consuming a significant amount of processing power.

```yaml:query.yaml showLineNumbers
config:
  target: "http://localhost:4000/graphql"
  phases:
    - duration: 60
      arrivalRate: 100
  payload:
      method: "POST"
      headers:
        Content-Type: "application/json"
      jsonBody:
        query: "query { user { id name email posts { id title author { id name email posts { id title author { id name email posts { id title author { id name } } } } } } } }"
```

This configuration sends 100 queries per second for 60 seconds. When we run this configuration against the server, we can see that the CPU usage spikes to 100%, indicating that the server is under attack.
